---
title: 'PostgreSQL-SQL-语法'
excerpt: '描述了SQL的语法，它是理解后续内容的基础，详细说明了如何应用SQL定义和修改数据。'
coverImage: '/assets/blog/postgresql/cover.jpg'
date: '2020-09-30T09:10:07.322Z'
author:
  name: 木子李
  picture: '/assets/blog/authors/tristan.jpg'
ogImage:
  url: '/assets/blog/postgresql/cover.jpg'
---

文字描述了SQL的语法，它是理解后续内容的基础，详细说明了如何应用SQL定义和修改数据。建议熟悉SQL的用户仔细阅读,因为它包含几个规则和概念，这些规则和概念在SQL数据库之间不一致地实现，或者特定于PostgreSQL。

## 词法结构

SQL输入由一系列命令(***commands***)组成。一条命令由一系列符号(***tokens***)组成，以逗号(;)结尾。

一个符号可以是关键字(***key word***)、标识符(identifier)、带引号的标识符(***quoted identifier***)、文字(或者常数)或者特殊字符。符号通常以空格符(space、tab、newline)分割,但不一定没有歧义。

例如，以下(句法上)是有效的SQL输入：
```sql
SELECT * FROM MY_TABLE;
UPDATE MY_TABLE SET A = 5;
INSERT INTO MY_TABLE VALUES (3, 'hi there');
```  

这里的每行组成了三条连续的命令。  

例外，注释(comments)可以在SQL输入里出现。它们不是符号，在效用上等同于空白符。

关于什么符号标识命令、操作符或者参数，SQL的语法没用那么严谨。开头的符号通常是命令名称，所以以上的样例我们通常叫做“SELECT”、“UPDATE”、“INSERT”命令。但是`UPDATE`命令在特定位置始终需要`SET`符号，类似的有`INSERT`，为了成功执行，也需要`VALEUES`符号。

### 标识符和关键字
上述例子中像SELECT、UPDATE或者VALUES符号是关键字的举例，的确，这些文字在SQL语言中有固定的含义。符号`MY_TABLE`和`A`是标识符的举例。它们标识了表、列或者数据库对象，取决于命令的使用。因此，他们有时简单的叫做“名字”。关键字和标识符有相同的词法结构，这意味着如果不知道语言的话，你不能分辨哪个符号是标识符，哪个符号是关键字。  

SQL的标识符和关键字必须以字母(a-z)或者下划线开头(_)，后续的可以是字母、下划线、数字(0-9)、美元符($)。

系统使用不超过`NAMEDATALEN-1`个字节的标识符，长命名可以指令里编写但会被截取。默认的，`NAMEDATALEN`是64位，最大标识符的长度是63字节。如果这个限制有问题，可以在`src/include/pg_config_manual.h`修改`NAMEDATALEN`常量。

关键字和标识符不区分大小写，因此
```sql
UPDATE MY_TABLE SET A = 5;
```
可以写成：
```sql
uPDaTE my_TabLE SeT a = 5;
```
关键字大写名字小写的习惯通常被使用，比如：
```sql
UPDATE my_table SET a = 5;
``` 
带引号的标识符再次不讨论。

### 常量
在PostgreSQL里有三类隐含类型的常量：字符串，字符和数字。常量也可以用显式类型指定，这可以使系统实现更精确的表示和更有效的处理。

#### 字符串常量
在SQL里一个字符串常量是单引号包裹的任意序列字符串，比如'This is a string'。为了在字符串常量里包含单引号，需要写两个连续的单引号，比如'Dianne''s horse'，注意它不是双引号(")。

用空格符和跨行符连接的两个字符串常量等效的被看作一个字符串，就好像他们写在一起，比如：
```sql
SELECT 'foo'  
'bar';
```
等同于：
```sql
SELECT 'foobar';
```
但是：
```sql
SELECT 'foo'    'bar';
```
是非法的语法。

#### 数值常量
数值常量通常是以下的形式：
```bash
digits
digits.[digits][e[+-]digits]
digits[.digits][e[+-]digits]
digitse[+-]digits
```
``digist``是一个或者多个十进制数(0到9)。小数点之前或之后必须至少有一位数字，指数标记（e）后必须至少一位数字，常量中不能嵌入任何空格或其他字符，请注意，任何前导的正号或负号实际上并未视为常量的一部分，它是应用于常量的操作符。

这些是有效数字常量的一些示例：
```
42  
3.5  
4.  
.001  
5e2  
1.925e-3  
```

如果既不包含小数点也不包含指数的数字常量的值适合整数类型（32位），则最初将其假定为整数类型；否则，如果其值适合bigint类型（64位），则假定它为bigint类型；否则，将其视为numeric类型；包含小数点和/或指数的常量最初总是假定为数字类型。

他最初分配的数值常量的数据类型只是类型解析算法的起点。 在大多数情况下，常量将根据上下文自动强制为最合适的类型。 必要时，可以通过强制转换数值将其解释为特定的数据类型。 例如，您可以通过编写以下代码来将数值强制为REAL （float4）类型：
```sql
REAL '1.23'  -- string style
1.23::REAL   -- PostgreSQL (historical) style
```

### 操作符
### 特殊字符
### 注释
### 操作符优先级

## 值表达式
### 列引用
### 位置参数
### 订阅
### 选取字段
### 操作符调用方式
### 函数调用
### 聚合表达式
### 窗口函数调用
### 类型转换
### 归类表达式
### 标量子查询
### 数组构造器
### 行构造器
### 表达式评估规则

## 调用函数
### 使用位置符号
### 使用命名符号
### 使用混合符号 